# 多益网络

自我介绍

项目经历

手撕：

题目描述：

今天在多益面试的时候，面试官让我手撕代码，我现在来回忆一下手撕的要求，请你帮我解答： 

1.   实现一个 NPC 类，路灯类，玩家类； 
2.   实现一个地图管理类，能够根据输入初始化地图的长和宽； 
3.   实现一个在地图中随机初始化路灯和NPC位置的功能； 
4.   输入玩家的位置，输出玩家能够“看到”的NPC； 

 其中玩家能够“看到”是指，玩家有一定的视野范围，路灯有一定的照射范围，只有当NPC同时出现在路灯的光照范围和玩家的视野范围内，NPC才能被玩家“看到”。

代码：

```cpp
#include <iostream>
#include <vector>
#include <string>
#include <cmath>
#include <random>
#include <ctime>
#include <set>

// ---------------------------------------------------
// 1. 实现 NPC、路灯和玩家类
// ---------------------------------------------------

class MapObject {
protected:
    int x;
    int y;

public:
    MapObject(int x_coord, int y_coord) : x(x_coord), y(y_coord) {}
    virtual ~MapObject() = default;

    int getX() const { return x; }
    int getY() const { return y; }
};

class NPC : public MapObject {
private:
    std::string name;

public:
    NPC(int x, int y, const std::string& npc_name) : MapObject(x, y), name(npc_name) {}
    std::string getName() const { return name; }
};

class Player : public MapObject {
private:
    double view_range;

public:
    Player(int x, int y, double range) : MapObject(x, y), view_range(range) {}
    double getViewRange() const { return view_range; }
};

class StreetLight : public MapObject {
private:
    double light_range;

public:
    StreetLight(int x, int y, double range) : MapObject(x, y), light_range(range) {}
    double getLightRange() const { return light_range; }
};

// ---------------------------------------------------
// 2. 实现地图管理类
// ---------------------------------------------------

class MapManager {
private:
    int width;
    int height;
    std::vector<NPC> npcs;
    std::vector<StreetLight> street_lights;

    // 辅助函数：计算两点间距离
    double getDistance(const MapObject& obj1, const MapObject& obj2) const {
        double dx = static_cast<double>(obj1.getX() - obj2.getX());
        double dy = static_cast<double>(obj1.getY() - obj2.getY());
        return std::sqrt(dx * dx + dy * dy);
    }
    
    // 辅助函数：判断是否在范围内
    bool isWithinRange(const MapObject& obj1, const MapObject& obj2, double range) const {
        return getDistance(obj1, obj2) <= range;
    }

public:
    MapManager(int w, int h) : width(w), height(h) {}

    // ---------------------------------------------------
    // 3. 实现随机初始化功能
    // ---------------------------------------------------
    void populateMap(int num_npcs, int num_lights, double light_range) {
        std::srand(static_cast<unsigned int>(std::time(nullptr)));
        
        std::set<std::pair<int, int>> occupied_positions;
        
        // 生成NPC
        for (int i = 0; i < num_npcs; ++i) {
            int x, y;
            do {
                x = std::rand() % width;
                y = std::rand() % height;
            } while (occupied_positions.count({x, y}));
            
            occupied_positions.insert({x, y});
            npcs.emplace_back(x, y, "NPC_" + std::to_string(i + 1));
        }

        // 生成路灯
        for (int i = 0; i < num_lights; ++i) {
            int x, y;
            do {
                x = std::rand() % width;
                y = std::rand() % height;
            } while (occupied_positions.count({x, y}));
            
            occupied_positions.insert({x, y});
            street_lights.emplace_back(x, y, light_range);
        }
    }

    // ---------------------------------------------------
    // 4. 输入玩家位置，输出可见NPC
    // ---------------------------------------------------
    std::vector<NPC> getVisibleNPCs(const Player& player) const {
        std::vector<NPC> visible_npcs;
        
        for (const auto& npc : npcs) {
            bool in_player_view = isWithinRange(player, npc, player.getViewRange());
            
            if (!in_player_view) {
                continue;
            }
            
            bool in_light = false;
            for (const auto& light : street_lights) {
                if (isWithinRange(light, npc, light.getLightRange())) {
                    in_light = true;
                    break;
                }
            }
            
            if (in_light) {
                visible_npcs.push_back(npc);
            }
        }
        
        return visible_npcs;
    }

    // 辅助方法，用于 main 函数中打印信息
    const std::vector<NPC>& getAllNPCs() const { return npcs; }
    const std::vector<StreetLight>& getAllStreetLights() const { return street_lights; }
};

// ---------------------------------------------------
// 主函数
// ---------------------------------------------------

int main() {
    // 1. 初始化地图
    const int map_width = 50;
    const int map_height = 50;
    MapManager game_map(map_width, map_height);

    // 2. 在地图上随机生成NPC和路灯
    const int num_npcs = 10;
    const int num_lights = 5;
    const double light_range = 8.0;
    game_map.populateMap(num_npcs, num_lights, light_range);

    std::cout << "地图初始化完毕，尺寸：" << map_width << "x" << map_height << std::endl;
    std::cout << "生成了 " << game_map.getAllNPCs().size() << " 个NPC 和 "
              << game_map.getAllStreetLights().size() << " 个路灯。" << std::endl;

    // 打印所有NPC和路灯的位置
    std::cout << "\n所有NPC的位置：" << std::endl;
    for (const auto& npc : game_map.getAllNPCs()) {
        std::cout << "  - " << npc.getName() << ": (" << npc.getX() << ", " << npc.getY() << ")" << std::endl;
    }
    std::cout << "\n所有路灯的位置和范围 (范围: " << light_range << "):" << std::endl;
    for (const auto& light : game_map.getAllStreetLights()) {
        std::cout << "  - 路灯: (" << light.getX() << ", " << light.getY() << ")" << std::endl;
    }
    
    // 3. 输入玩家位置，并查询可见NPC
    const int player_x = 25;
    const int player_y = 25;
    const double player_view_range = 15.0;
    Player player(player_x, player_y, player_view_range);
    
    std::cout << "\n玩家当前位置: (" << player.getX() << ", " << player.getY() 
              << ")，视野范围: " << player.getViewRange() << std::endl;

    std::vector<NPC> visible_npcs = game_map.getVisibleNPCs(player);

    // 4. 输出结果
    if (!visible_npcs.empty()) {
        std::cout << "\n玩家能够看到的NPC：" << std::endl;
        for (const auto& npc : visible_npcs) {
            std::cout << "  - " << npc.getName() << ": (" << npc.getX() << ", " << npc.getY() << ")" << std::endl;
        }
    } else {
        std::cout << "\n玩家视野内没有NPC，或者NPC不在任何路灯的照射范围内。" << std::endl;
    }

    return 0;
}
```

