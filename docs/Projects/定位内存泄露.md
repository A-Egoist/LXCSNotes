# 定位内存泄露

## 什么是内存泄露



## 如何定位内存泄露

*   静态检测工具。使用 cppcheck 或 clang-tidy 来检查代码中是否出现内存泄漏，但是有局限性。

*   动态检测

    *   valgrind。`valgrind --leak-check=full 可执行程序`。将 valgrind 视为虚拟机，将可执行程序当做文件来处理，读取二进制文件的内容，进行指令解析并执行。需要可执行程序携带调试信息，以便定位到具体的代码位置。
        ```bash
        valgrind --leak-check=full ./main
        ```

        

    *   hook + backtrace

        *   hook 住内存分配和内存释放的接口
        *   每次申请内存都记录一下，每次释放时也记录一下，然后再把这两种记录进行一个比较，把相同的去掉，剩下的就是没有释放的。
        *   同时在申请内存时，记录其调用堆栈信息
        *   侵入式
        *   需要调试信息

    *   eBPF + uprobes

        *   非侵入式
        *   不需要调试信息
        *   原理和上面一种相同，但是运行在内核

>   参考资料：
>
>   [1] [Linux内存泄露定位1：valgrind篇](https://mp.weixin.qq.com/s/dWbqNIA4pLWs4pd53Gaq8A)
>
>   [2] [Linux内存泄露定位3：hook+backtrace篇](https://mp.weixin.qq.com/s/JX2NVI35ze02k7LwCodhLA)
>
>   [3] [Linux内存泄露定位4：eBPF+uprobes 篇](https://mp.weixin.qq.com/s/gb3hcwgoFXTiZhmWxyf-bg)
>
>   [4] [Linux内存泄露定位5：gdb+python篇](https://mp.weixin.qq.com/s/j1Lc43zN49xhOKfx-eInRQ)
>
>   [5] [Linux内存泄露定位2：mtrace篇](https://mp.weixin.qq.com/s?__biz=MzU4NjY0NTExNA==&mid=2247486485&idx=1&sn=a4ff43bbf0f25700369fd433ac66613a&poc_token=HA0qp2ijFlkKYA-7XZx4Pro38DJgZSW43XV3lm1F)
>
>   [6] [拼多多C++一面：内存泄露相关面试题，什么是内存泄露？列举检测内存泄露的方案](https://www.bilibili.com/video/BV1T3q5YpEzt/?spm_id_from=333.337.search-card.all.click&vd_source=f4cc25a44af6631d6f4db023b3bb88e4)
>
>   [7] [【C++】 使用CRT 库检测内存泄漏](https://blog.csdn.net/qq_65207641/article/details/139372244)

